<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PBL Project Builder</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 920px; margin: 32px auto; padding: 0 16px; }
    h1 { margin-bottom: 8px; }
    .row { display: grid; grid-template-columns: 1fr 2fr; gap: 12px; margin: 10px 0; }
    textarea, input, button { font: inherit; padding: 8px; }
    .modules { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 6px; }
    .out { white-space: pre-wrap; border: 1px solid #ddd; padding: 12px; border-radius: 6px; min-height: 220px; background: #fafafa; }
    .muted { color: #666; font-size: 0.9em; }
    .actions { display: flex; gap: 10px; align-items: center; }
  </style>
</head>
<body>
  <h1>PBL Project Builder</h1>
  <p class="muted">Provide <strong>Title</strong> and <strong>Topic/Subject</strong>. Everything else has smart defaults (edit if you like).</p>

  <div class="row">
    <label>Title *</label>
    <input id="title" placeholder="e.g., Sustainable City Studio" required />
  </div>

  <div class="row">
    <label>Topic / Subject *</label>
    <input id="topic" placeholder="e.g., Environmental Science" required />
  </div>

  <div class="row">
    <label>Grade/Level</label>
    <input id="grade" placeholder="Grade 9 (default)" />
  </div>

  <div class="row">
    <label>Duration (weeks)</label>
    <input id="duration_weeks" placeholder="4 (default)" />
  </div>

  <div class="row">
    <label>Driving Question</label>
    <textarea id="driving_question" rows="2"
      placeholder="How might we design a solution that improves our community’s sustainability?"></textarea>
  </div>

  <div class="row">
    <label>Scenario</label>
    <textarea id="scenario" rows="2"
      placeholder="Partner with a local stakeholder to gather authentic constraints and feedback."></textarea>
  </div>

  <div class="row">
    <label>Modules</label>
    <div class="modules" id="modules">
      <label><input type="checkbox" value="Overview" checked /> Overview</label>
      <label><input type="checkbox" value="Learning Objectives" checked /> Learning Objectives</label>
      <label><input type="checkbox" value="Timeline & Milestones" checked /> Timeline &amp; Milestones</label>
      <label><input type="checkbox" value="Activities & Procedures" checked /> Activities &amp; Procedures</label>
      <label><input type="checkbox" value="Assessment Rubric" checked /> Assessment Rubric</label>
      <label><input type="checkbox" value="Deliverables" checked /> Deliverables</label>
      <label><input type="checkbox" value="Materials" checked /> Materials</label>
    </div>
  </div>

  <div class="row" style="grid-template-columns: 1fr;">
    <div class="actions">
      <button id="go">Generate</button>
      <a id="dl" href="#" style="display:none;">Download PDF</a>
      <span id="status" class="muted"></span>
    </div>
  </div>

  <h3>Output</h3>
  <div id="out" class="out">Fill the required fields and click “Generate”.</div>

  <script>
    const el = (id) => document.getElementById(id);

    function selectedModules() {
      return Array.from(document.querySelectorAll("#modules input:checked")).map(c => c.value);
    }

    document.getElementById("go").addEventListener("click", async () => {
      const title = el("title").value.trim();
      const topic = el("topic").value.trim();
      if (!title || !topic) {
        el("status").textContent = "Please enter Title and Topic.";
        return;
      }

      const payload = {
        title,
        topic,
        grade: el("grade").value,
        duration_weeks: el("duration_weeks").value,
        driving_question: el("driving_question").value,
        scenario: el("scenario").value,
        modules: selectedModules()
      };

      el("status").textContent = "Generating…";
      el("out").textContent = "Generating…";
      el("dl").style.display = "none";
      el("dl").removeAttribute("href");

      try {
        const resp = await fetch("/generate", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });
        const data = await resp.json();
        if (!data.ok) throw new Error(data.error || "Unknown error");

        el("out").textContent = data.result;
        el("status").textContent = "Done.";
        if (data.pdf_id) {
          el("dl").href = "/download/" + data.pdf_id;
          el("dl").style.display = "inline-block";
          el("dl").textContent = "Download PDF";
        }
      } catch (err) {
        el("status").textContent = "Error";
        el("out").textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
</html>

